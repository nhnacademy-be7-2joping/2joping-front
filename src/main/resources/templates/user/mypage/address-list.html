<!DOCTYPE html>
<html lang="ko" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/mypage-layout}" th:with="activePage='address-list'">
<head>
    <meta charset="UTF-8">
    <title>배송지 목록</title>
    <link rel="stylesheet" th:href="@{/css/mypage-style.css}">
    <style>
        /* Shared styles for cards and forms */
        .address-card, .address-form-container {
            background-color: #ffffff;
            border: 2px solid var(--primary-color, #a36afa);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            color: #333;
            font-family: "Pretendard Variable", "Noto Sans KR", sans-serif;
            width: 100%;
            max-width: 800px;
            margin: 10px auto;
        }
        .address-content{
            display: flex;
            flex-direction: row;
            align-items: center; /* 수직 중앙 정렬 */

        }
        .address-content label{
            width: 80px;
            text-align: left;



        }
        .address-form-container {
            display: none;
        }

        .form-header, .address-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .address-title, .form-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color, #a36afa);
        }

        .address-actions {
            display: flex;
            gap: 10px;
        }

        .address-action-button, .save-button, .cancel-button, .search-button {
            background-color: var(--primary-color, #a36afa);
            color: #ffffff;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .address-action-button:hover, .save-button:hover, .cancel-button:hover, .search-button:hover {
            background-color: #944cff;
        }

        .form-row label {
            font-weight: bold;
            color: #555;
        }

        .form-row input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        /* 인풋 박스 스타일 */
        .edit-input {
            display: none;
            width: 100%;
            padding: 10px;
            border: 1px solid var(--primary-color, #a36afa);
            border-radius: 8px;
            font-size: 14px;
            color: #333;
            font-family: "Pretendard Variable", "Noto Sans KR", sans-serif;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            margin-top: 5px;
            background-color: #f9f9f9;
        }

        .edit-input.active {
            display: block;
            transition: all 0.3s ease;
        }

        /* 기본 버튼 스타일 */
        .address-action-button, .save-button, .cancel-button {
            background-color: var(--primary-color, #a36afa);
            color: #ffffff;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .address-action-button:hover, .save-button:hover, .cancel-button:hover {
            background-color: #944cff;
        }

        /* 수정 중 뷰 모드 숨김 */
        .view-mode {
            font-size: 16px;
            font-weight: bold;
            width: fit-content;
        }
        .input-wrapper {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .input-wrapper label {
            font-size: 14px;
            font-weight: bold;
            color: #555;
        }

        .input-with-label {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--primary-color, #a36afa);
            border-radius: 8px;
            font-size: 14px;
            color: #333;
            font-family: "Pretendard Variable", "Noto Sans KR", sans-serif;
            background-color: #f9f9f9;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }
        /* Switch CSS */
        .switch {
            position: relative;
            display: inline-block;
            width: 34px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 20px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 12px;
            width: 12px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #a36afa;
        }

        input:checked + .slider:before {
            transform: translateX(14px);
        }
    </style>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        function toggleAddressForm() {
            const formContainer = document.getElementById('addressFormContainer');
            formContainer.style.display = formContainer.style.display === 'none' || !formContainer.style.display ? 'block' : 'none';
        }

        function openPostcodeSearch() {
            new daum.Postcode({
                oncomplete: function(data) {
                    document.getElementById('postalCode').value = data.zonecode;
                    document.getElementById('roadAddress').value = data.roadAddress;
                }
            }).open();
        }

        function enableEditMode(button) {
            const card = button.closest('.address-card');
            const inputs = card.querySelectorAll('.edit-input');
            const spans = card.querySelectorAll('.view-mode');
            const saveBtn = card.querySelector('.save-button');
            const cancelBtn = card.querySelector('.cancel-button');
            const editBtn = card.querySelector('.edit-btn');

            inputs.forEach(input => input.classList.add('active'));
            spans.forEach(span => span.style.display = 'none');

            saveBtn.style.display = 'block';
            cancelBtn.style.display = 'block';
            editBtn.style.display = 'none';
        }

        function cancelEditMode(button) {
            const card = button.closest('.address-card');
            const inputs = card.querySelectorAll('.edit-input');
            const spans = card.querySelectorAll('.view-mode');
            const saveBtn = card.querySelector('.save-button');
            const cancelBtn = card.querySelector('.cancel-button');
            const editBtn = card.querySelector('.edit-btn');

            // 입력값 초기화
            inputs.forEach(input => {
                const span = card.querySelector(`.view-mode[th\\:text*='${input.name}']`);
                if (span) {
                    input.value = span.textContent.trim();
                }
                input.classList.remove('active');
            });

            // 뷰 모드 표시
            spans.forEach(span => span.style.display = 'block');

            // 버튼 상태 업데이트
            saveBtn.style.display = 'none';
            cancelBtn.style.display = 'none';
            editBtn.style.display = 'block';
        }

    </script>
</head>
<body>


<div class="mypage-container" layout:fragment="content">
    <!-- 폼 열기 버튼 -->
    <div id="error-container"
         th:if="${errorCode != null and errorMessage != null}"
         th:attr="data-error-code=${errorCode}, data-error-message=${errorMessage}">
    </div>
    <button type="button" class="address-action-button" onclick="toggleAddressForm()">배송지 추가</button>

    <!-- Address Addition Form -->
    <div id="addressFormContainer" class="address-form-container">
        <form action="/members/address" method="post">
            <div class="form-header">
                <div class="form-title">배송지 추가</div>
                <button type="button" class="address-action-button" onclick="toggleAddressForm()">닫기</button>
            </div>
            <div class="form-row">
                <label for="postalCode">우편번호</label>
                <input type="text" id="postalCode" name="postalCode" placeholder="우편번호" readonly>
                <button type="button" class="search-button" onclick="openPostcodeSearch()">주소 검색</button>
            </div>
            <div class="form-row">
                <label for="roadAddress">도로명 주소</label>
                <input type="text" id="roadAddress" name="roadAddress" placeholder="도로명 주소" readonly>
            </div>
            <div class="form-row">
                <label for="detailAddress">상세 주소</label>
                <input type="text" id="detailAddress" name="detailAddress" placeholder="상세 주소">
            </div>
            <div class="form-row">
                <label for="addressAlias">주소 별칭</label>
                <input type="text" id="addressAlias" name="addressAlias" placeholder="예: 집, 회사">
            </div>
            <div class="form-row">
                <label for="receiver">받는이</label>
                <input type="text" id="receiver" name="receiver" placeholder="받는이 이름">
            </div>
            <div class="form-row">
                <label for="defaultAddress">기본 배송지 설정:</label>
                <!-- hidden 필드 제거 -->

                <label class="switch">
                    <input type="checkbox" id="defaultAddress" name="defaultAddress" th:checked="${defaultAddress}" value="true">
                    <span class="slider round"></span>
                </label>
                <input type="hidden" name="defaultAddress" value="false">

            </div>
            <button type="submit" class="save-button">저장</button>
        </form>
    </div>



    <div class="address-list">
        <!-- Address Card -->



        <div class="address-card" th:each="address, stat : ${addresses}">
            <form th:action="@{/addresses/update}" method="post">
                <div class="address-header">
                    <div class="address-title">
                        <span class="view-mode" th:text="${address.addressAlias}"></span>
                        <input type="text" name="addressAlias" th:value="${address.addressAlias}"
                               th:id="'addressAlias-' + ${stat.index}" class="edit-input">
                    </div>
                    <div class="address-actions">
                        <button type="button" class="address-action-button edit-btn" onclick="enableEditMode(this)">수정</button>
                        <button type="submit" class="address-action-button save-button" style="display: none;">저장</button>
                        <button type="button" class="address-action-button cancel-button" style="display: none;" onclick="cancelEditMode(this)">취소</button>
                        <a th:href="@{'/addresses/delete/' + ${address.memberAddressId}}"
                           class="address-action-button"
                           onclick="return confirm('이 주소를 삭제하시겠습니까?')">삭제</a>
                    </div>
                </div>
                <div class="address-content">
                    <label th:for="'receiver-' + ${stat.index}">받는이:</label>
                    <span class="view-mode" th:text="${address.receiver}"></span>

                    <input type="text" name="receiver" th:value="${address.receiver}"
                           th:id="'receiver-' + ${stat.index}" class="edit-input">
                </div>
                <div class="address-content">
                    <label th:for="'postalCode-' + ${stat.index}">우편번호:</label>
                    <span class="view-mode" th:text="${address.postalCode}"></span>
                    <input type="text" name="postalCode" th:value="${address.postalCode}"
                           th:id="'postalCode-' + ${stat.index}" class="edit-input" readonly>
                    <button type="button" class="search-button edit-input" onclick="openPostcodeSearch()" style="display: none;">주소 검색</button>
                </div>
                <div class="address-content">
                    <label th:for="'roadAddress-' + ${stat.index}">도로명:</label>
                    <span class="view-mode" th:text="${address.roadAddress}"></span>
                    <input type="text" name="roadAddress" th:value="${address.roadAddress}"
                           th:id="'roadAddress-' + ${stat.index}" class="edit-input" readonly>
                </div>
                <div class="address-content">
                    <label th:for="'detailAddress-' + ${stat.index}">상세주소:</label>
                    <span class="view-mode" th:text="${address.detailAddress}"></span>
                    <input type="text" name="detailAddress" th:value="${address.detailAddress}"
                           th:id="'detailAddress-' + ${stat.index}" class="edit-input">
                </div>
            </form>
        </div>




    </div>


</div>
</body>
</html>